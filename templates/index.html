<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H·ªá th·ªëng H·ªó tr·ª£ Ph√°t hi·ªán S·ªõm Parkinson</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, #e0f2fe 0%, #f0f9ff 50%, #ecfeff 100%);
            min-height: 100vh;
        }
        
        .scrollbar-thin {
            scrollbar-width: thin;
            scrollbar-color: #9ca3af #f8f9fa;
        }
        .scrollbar-thin::-webkit-scrollbar { width: 8px; }
        .scrollbar-thin::-webkit-scrollbar-track { background: #f8f9fa; border-radius: 10px; }
        .scrollbar-thin::-webkit-scrollbar-thumb { background: #9ca3af; border-radius: 10px; }
        
        input[type="checkbox"] {
            width: 24px;
            height: 24px;
            cursor: pointer;
            flex-shrink: 0;
            accent-color: #0d9488;
        }
        
        @keyframes recording-pulse {
            0%, 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
            50% { transform: scale(1.05); box-shadow: 0 0 0 15px rgba(239, 68, 68, 0); }
        }
        .recording-animation { animation: recording-pulse 1s ease-in-out infinite; }
        
        .prose-custom { line-height: 1.9; font-size: 1rem; }
        .prose-custom p { margin-bottom: 0.75rem; }
        .prose-custom strong { color: #0f766e; font-weight: 600; }
        .prose-custom ul, .prose-custom ol { margin-left: 1.25rem; margin-top: 0.5rem; margin-bottom: 0.75rem; }
        .prose-custom li { margin-bottom: 0.5rem; padding-left: 0.25rem; }
        
        .header-gradient { background: linear-gradient(135deg, #0d9488 0%, #0891b2 50%, #0284c7 100%); }
        
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        
        .voice-btn { transition: all 0.3s ease; }
        .voice-btn:hover { transform: scale(1.05); }
        .voice-btn.recording { background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%) !important; }
        
        .feature-card { transition: all 0.3s ease; }
        .feature-card:hover { transform: translateY(-4px); }
        
        .youtube-embed {
            position: relative;
            padding-bottom: 56.25%;
            height: 0;
            overflow: hidden;
            border-radius: 12px;
            background: #000;
        }
        .youtube-embed iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: 0;
        }
        
        .symptom-group { transition: all 0.3s ease; }
        .symptom-group:hover { background-color: rgba(20, 184, 166, 0.05); }
        
        #tts-indicator {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            transition: all 0.3s ease;
        }
    </style>
</head>
<body class="text-gray-800">
    <!-- TTS Indicator -->
    <div id="tts-indicator" class="hidden bg-green-500 text-white px-4 py-2 rounded-full shadow-lg flex items-center">
        <i class="fas fa-volume-up mr-2 animate-pulse"></i>
        <span>ƒêang ƒë·ªçc...</span>
    </div>

    <!-- HEADER -->
    <header class="header-gradient text-white py-5 px-4 shadow-lg">
        <div class="container mx-auto">
            <div class="flex items-center justify-between flex-wrap gap-4">
                <div class="flex items-center">
                    <div class="w-14 h-14 bg-white/20 rounded-xl flex items-center justify-center mr-4 backdrop-blur-sm">
                        <i class="fas fa-brain text-3xl"></i>
                    </div>
                    <div>
                        <h1 class="text-xl lg:text-2xl font-bold">H·ªá th·ªëng H·ªó tr·ª£ Ph√°t hi·ªán S·ªõm Parkinson</h1>
                    </div>
                </div>
                <div class="flex items-center space-x-3">
                    <!-- Global TTS Toggle -->
                    <button id="global-tts-toggle" class="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-lg backdrop-blur-sm flex items-center transition-all" title="B·∫≠t/T·∫Øt ƒë·ªçc t·∫•t c·∫£ c√¢u tr·∫£ l·ªùi">
                        <i class="fas fa-volume-up mr-2" id="global-tts-icon"></i>
                        <span class="text-sm" id="global-tts-text">Loa: B·∫¨T</span>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- MAIN CONTENT -->
    <main class="container mx-auto p-4 lg:p-6">
        <!-- Warning Banner -->
        <div class="mb-6 p-4 bg-gradient-to-r from-amber-50 to-yellow-50 border-2 border-yellow-300 rounded-2xl shadow-md">
            <div class="flex items-start">
                <div class="w-12 h-12 bg-yellow-400 rounded-xl flex items-center justify-center mr-4 flex-shrink-0">
                    <i class="fas fa-exclamation-triangle text-white text-xl"></i>
                </div>
                <div>
                    <h3 class="font-bold text-yellow-800 text-lg mb-1">‚ö†Ô∏è L∆∞u √Ω Quan tr·ªçng</h3>
                    <p class="text-yellow-700 text-sm leading-relaxed">
                        ƒê√¢y l√† c√¥ng c·ª• <strong>h·ªó tr·ª£ s√†ng l·ªçc ban ƒë·∫ßu</strong>, KH√îNG thay th·∫ø ch·∫©n ƒëo√°n c·ªßa b√°c sƒ© chuy√™n khoa Th·∫ßn kinh. 
                        M·ªçi th√¥ng tin ch·ªâ mang t√≠nh tham kh·∫£o. <strong>KH√îNG t·ª± √Ω s·ª≠ d·ª•ng thu·ªëc t·∫°i nh√†</strong> m√† kh√¥ng c√≥ ch·ªâ ƒë·ªãnh c·ªßa b√°c sƒ©.
                        N·∫øu c√≥ tri·ªáu ch·ª©ng nghi ng·ªù, vui l√≤ng ƒë·∫øn c∆° s·ªü y t·∫ø ƒë·ªÉ ƒë∆∞·ª£c thƒÉm kh√°m ch√≠nh x√°c.
                    </p>
                </div>
            </div>
        </div>

        <!-- Main Grid - 2 columns -->
        <div class="grid lg:grid-cols-2 gap-6">
            
            <!-- LEFT COLUMN: Image + Symptoms Combined -->
            <div class="space-y-6">
                <!-- Image Upload Section -->
                <div class="bg-white rounded-2xl shadow-xl p-5 border border-gray-100">
                    <h2 class="text-lg font-bold mb-4 text-blue-800 flex items-center">
                        <div class="w-9 h-9 bg-blue-100 rounded-lg flex items-center justify-center mr-3">
                            <i class="fas fa-camera text-blue-600"></i>
                        </div>
                        <span>B∆∞·ªõc 1: T·∫£i ·∫£nh Xo·∫Øn ·ªëc</span>
                    </h2>
                    
                    <form id="upload-form" class="space-y-4">
                        <div class="border-2 border-dashed border-gray-300 rounded-xl p-6 text-center hover:border-blue-400 hover:bg-blue-50/30 transition-all cursor-pointer" id="drop-zone">
                            <input type="file" name="image" accept="image/*" class="hidden" id="file-input">
                            <label for="file-input" class="cursor-pointer block" id="file-label">
                                <div class="text-gray-400 mb-2">
                                    <i class="fas fa-cloud-upload-alt text-5xl"></i>
                                </div>
                                <p class="text-base font-semibold text-gray-700">K√©o th·∫£ ho·∫∑c B·∫•m ƒë·ªÉ ch·ªçn ·∫£nh</p>
                                <p class="text-xs text-gray-500 mt-1">PNG, JPG, JPEG - ·∫¢nh v·∫Ω xo·∫Øn ·ªëc tr√™n gi·∫•y A4</p>
                            </label>
                        </div>
                        <div id="image-preview" class="hidden">
                            <img id="preview-img" class="w-full h-48 object-contain rounded-lg bg-gray-100">
                        </div>
                    </form>
                </div>

                <!-- Symptom Checklist -->
                <div class="bg-white rounded-2xl shadow-xl p-5 border border-gray-100">
                    <h2 class="text-lg font-bold mb-4 text-teal-800 flex items-center">
                        <div class="w-9 h-9 bg-teal-100 rounded-lg flex items-center justify-center mr-3">
                            <i class="fas fa-clipboard-check text-teal-600"></i>
                        </div>
                        <span>B∆∞·ªõc 2: Ch·ªçn Tri·ªáu ch·ª©ng</span>
                    </h2>
                    
                    <form id="symptomForm" class="space-y-4 max-h-96 overflow-y-auto pr-2 scrollbar-thin">
                        <!-- TRI·ªÜU CH·ª®NG V·∫¨N ƒê·ªòNG CH√çNH -->
                        <fieldset class="border-2 border-teal-200 rounded-xl p-4 bg-gradient-to-br from-teal-50/50 to-white symptom-group">
                            <legend class="font-bold text-sm text-teal-800 px-2 bg-white rounded">üèÉ Tri·ªáu ch·ª©ng V·∫≠n ƒë·ªông Ch√≠nh</legend>
                            <div class="space-y-2 mt-2">
                                <label class="flex items-center space-x-3 text-sm cursor-pointer hover:bg-teal-50 p-2 rounded-lg">
                                    <input type="checkbox" value="Run tay khi ngh·ªâ ng∆°i (Resting Tremor) - run khi tay ƒëang th∆∞ gi√£n, gi·∫£m khi c·ª≠ ƒë·ªông">
                                    <span>Run tay khi ngh·ªâ ng∆°i (gi·∫£m khi c·ª≠ ƒë·ªông)</span>
                                </label>
                                <label class="flex items-center space-x-3 text-sm cursor-pointer hover:bg-teal-50 p-2 rounded-lg">
                                    <input type="checkbox" value="Run ki·ªÉu 'v√™ thu·ªëc' (Pill-rolling tremor) - ng√≥n c√°i v√† ng√≥n tr·ªè c·ªç v√†o nhau">
                                    <span>Run ki·ªÉu "v√™ thu·ªëc" (ng√≥n c√°i-ng√≥n tr·ªè)</span>
                                </label>
                                <label class="flex items-center space-x-3 text-sm cursor-pointer hover:bg-teal-50 p-2 rounded-lg">
                                    <input type="checkbox" value="Run b·∫Øt ƒë·∫ßu ·ªü m·ªôt b√™n c∆° th·ªÉ (Asymmetric onset)">
                                    <span>Run b·∫Øt ƒë·∫ßu ·ªü M·ªòT b√™n c∆° th·ªÉ</span>
                                </label>
                                <label class="flex items-center space-x-3 text-sm cursor-pointer hover:bg-teal-50 p-2 rounded-lg">
                                    <input type="checkbox" value="C·ª©ng ƒë·ªù c∆° b·∫Øp (Rigidity) - c·∫£m gi√°c c∆° cƒÉng c·ª©ng ·ªü c·ªï, vai, tay, ch√¢n">
                                    <span>C·ª©ng ƒë·ªù c∆° b·∫Øp (c·ªï, vai, tay, ch√¢n)</span>
                                </label>
                                <label class="flex items-center space-x-3 text-sm cursor-pointer hover:bg-teal-50 p-2 rounded-lg">
                                    <input type="checkbox" value="Ch·∫≠m v·∫≠n ƒë·ªông (Bradykinesia) - c√°c ƒë·ªông t√°c tr·ªü n√™n ch·∫≠m ch·∫°p, kh√≥ kh·ªüi ƒë·ªông">
                                    <span>Ch·∫≠m v·∫≠n ƒë·ªông, kh√≥ kh·ªüi ƒë·ªông ƒë·ªông t√°c</span>
                                </label>
                                <label class="flex items-center space-x-3 text-sm cursor-pointer hover:bg-teal-50 p-2 rounded-lg">
                                    <input type="checkbox" value="M·∫•t thƒÉng b·∫±ng t∆∞ th·∫ø (Postural Instability) - d·ªÖ ng√£, kh√≥ gi·ªØ thƒÉng b·∫±ng">
                                    <span>M·∫•t thƒÉng b·∫±ng, d·ªÖ ng√£</span>
                                </label>
                            </div>
                        </fieldset>

                        <!-- D·∫§U HI·ªÜU V·∫¨N ƒê·ªòNG PH·ª§ -->
                        <fieldset class="border-2 border-blue-200 rounded-xl p-4 bg-gradient-to-br from-blue-50/50 to-white symptom-group">
                            <legend class="font-bold text-sm text-blue-800 px-2 bg-white rounded">üö∂ D·∫•u hi·ªáu V·∫≠n ƒë·ªông Kh√°c</legend>
                            <div class="space-y-2 mt-2">
                                <label class="flex items-center space-x-3 text-sm cursor-pointer hover:bg-blue-50 p-2 rounded-lg">
                                    <input type="checkbox" value="D√°ng ƒëi shuffling - b∆∞·ªõc ng·∫Øn, k√©o l√™ ch√¢n, √≠t vung tay">
                                    <span>B∆∞·ªõc ƒëi ng·∫Øn, k√©o l√™ ch√¢n, √≠t vung tay</span>
                                </label>
                                <label class="flex items-center space-x-3 text-sm cursor-pointer hover:bg-blue-50 p-2 rounded-lg">
                                    <input type="checkbox" value="Freezing of gait - ƒë·ªôt ng·ªôt 'ƒë√≥ng bƒÉng' kh√¥ng b∆∞·ªõc ƒëi ƒë∆∞·ª£c">
                                    <span>ƒê·ªôt ng·ªôt "ƒë√≥ng bƒÉng" kh√¥ng b∆∞·ªõc ƒëi ƒë∆∞·ª£c</span>
                                </label>
                                <label class="flex items-center space-x-3 text-sm cursor-pointer hover:bg-blue-50 p-2 rounded-lg">
                                    <input type="checkbox" value="D√°ng ƒëi ƒë·ªï ng∆∞·ªùi v·ªÅ ph√≠a tr∆∞·ªõc (Festinating gait)">
                                    <span>D√°ng ƒëi ƒë·ªï ng∆∞·ªùi v·ªÅ ph√≠a tr∆∞·ªõc</span>
                                </label>
                                <label class="flex items-center space-x-3 text-sm cursor-pointer hover:bg-blue-50 p-2 rounded-lg">
                                    <input type="checkbox" value="Ch·ªØ vi·∫øt nh·ªè d·∫ßn (Micrographia) - ch·ªØ ng√†y c√†ng nh·ªè v√† kh√≥ ƒë·ªçc">
                                    <span>Ch·ªØ vi·∫øt nh·ªè d·∫ßn, kh√≥ ƒë·ªçc</span>
                                </label>
                                <label class="flex items-center space-x-3 text-sm cursor-pointer hover:bg-blue-50 p-2 rounded-lg">
                                    <input type="checkbox" value="N√©t m·∫∑t √≠t bi·ªÉu c·∫£m (Masked face/Hypomimia) - m·∫∑t nh∆∞ ƒëeo m·∫∑t n·∫°">
                                    <span>N√©t m·∫∑t √≠t bi·ªÉu c·∫£m ("m·∫∑t n·∫°")</span>
                                </label>
                                <label class="flex items-center space-x-3 text-sm cursor-pointer hover:bg-blue-50 p-2 rounded-lg">
                                    <input type="checkbox" value="Kh√≥ l√†m c√°c c√¥ng vi·ªác tinh vi (c√†i c√∫c √°o, bu·ªôc d√¢y gi√†y, c·∫Øt th·ª©c ƒÉn)">
                                    <span>Kh√≥ l√†m vi·ªác tinh vi (c√†i c√∫c, bu·ªôc d√¢y)</span>
                                </label>
                            </div>
                        </fieldset>

                        <!-- TRI·ªÜU CH·ª®NG PHI V·∫¨N ƒê·ªòNG -->
                        <fieldset class="border-2 border-purple-200 rounded-xl p-4 bg-gradient-to-br from-purple-50/50 to-white symptom-group">
                            <legend class="font-bold text-sm text-purple-800 px-2 bg-white rounded">üß† Tri·ªáu ch·ª©ng Phi-v·∫≠n ƒë·ªông</legend>
                            <div class="space-y-2 mt-2">
                                <label class="flex items-center space-x-3 text-sm cursor-pointer hover:bg-purple-50 p-2 rounded-lg">
                                    <input type="checkbox" value="Gi·∫£m ho·∫∑c m·∫•t kh·ª©u gi√°c (Hyposmia/Anosmia) - kh√¥ng ng·ª≠i ƒë∆∞·ª£c m√πi">
                                    <span>Gi·∫£m/m·∫•t kh·ª©u gi√°c (kh√¥ng ng·ª≠i ƒë∆∞·ª£c)</span>
                                </label>
                                <label class="flex items-center space-x-3 text-sm cursor-pointer hover:bg-purple-50 p-2 rounded-lg">
                                    <input type="checkbox" value="R·ªëi lo·∫°n gi·∫•c ng·ªß REM (RBD) - la h√©t, ƒë·∫•m ƒë√° khi ng·ªß">
                                    <span>La h√©t, ƒë·∫•m ƒë√°, c·ª≠ ƒë·ªông m·∫°nh khi ng·ªß</span>
                                </label>
                                <label class="flex items-center space-x-3 text-sm cursor-pointer hover:bg-purple-50 p-2 rounded-lg">
                                    <input type="checkbox" value="T√°o b√≥n m√£n t√≠nh nghi√™m tr·ªçng k√©o d√†i nhi·ªÅu nƒÉm">
                                    <span>T√°o b√≥n m√£n t√≠nh, k√©o d√†i</span>
                                </label>
                                <label class="flex items-center space-x-3 text-sm cursor-pointer hover:bg-purple-50 p-2 rounded-lg">
                                    <input type="checkbox" value="Gi·ªçng n√≥i nh·ªè, ƒë∆°n ƒëi·ªáu (Hypophonia) - kh√≥ nghe, thi·∫øu ng·ªØ ƒëi·ªáu">
                                    <span>Gi·ªçng n√≥i nh·ªè, ƒë∆°n ƒëi·ªáu, kh√≥ nghe</span>
                                </label>
                                <label class="flex items-center space-x-3 text-sm cursor-pointer hover:bg-purple-50 p-2 rounded-lg">
                                    <input type="checkbox" value="Tr·∫ßm c·∫£m, lo √¢u kh√¥ng r√µ nguy√™n nh√¢n">
                                    <span>Tr·∫ßm c·∫£m, lo √¢u kh√¥ng r√µ nguy√™n nh√¢n</span>
                                </label>
                                <label class="flex items-center space-x-3 text-sm cursor-pointer hover:bg-purple-50 p-2 rounded-lg">
                                    <input type="checkbox" value="Ch√≥ng m·∫∑t khi ƒë·ª©ng d·∫≠y (Orthostatic hypotension)">
                                    <span>Ch√≥ng m·∫∑t khi ƒë·ª©ng d·∫≠y ƒë·ªôt ng·ªôt</span>
                                </label>
                                <label class="flex items-center space-x-3 text-sm cursor-pointer hover:bg-purple-50 p-2 rounded-lg">
                                    <input type="checkbox" value="Suy gi·∫£m nh·∫≠n th·ª©c nh·∫π, hay qu√™n">
                                    <span>Hay qu√™n, suy gi·∫£m nh·∫≠n th·ª©c nh·∫π</span>
                                </label>
                                <label class="flex items-center space-x-3 text-sm cursor-pointer hover:bg-purple-50 p-2 rounded-lg">
                                    <input type="checkbox" value="TƒÉng ti·∫øt m·ªì h√¥i ho·∫∑c da nh·ªùn b·∫•t th∆∞·ªùng">
                                    <span>TƒÉng ti·∫øt m·ªì h√¥i, da nh·ªùn b·∫•t th∆∞·ªùng</span>
                                </label>
                            </div>
                        </fieldset>
                    </form>

                    <!-- Combined Analysis Button -->
                    <button type="button" id="combined-analysis-btn" class="w-full mt-5 bg-gradient-to-r from-indigo-600 to-purple-600 text-white py-4 px-4 rounded-xl hover:from-indigo-700 hover:to-purple-700 transition-all font-bold text-lg shadow-lg hover:shadow-xl">
                        <i class="fas fa-brain mr-2"></i>
                        Ph√¢n t√≠ch T·ªïng h·ª£p (·∫¢nh + Tri·ªáu ch·ª©ng)
                    </button>
                </div>

                <!-- Combined Result -->
                <div id="combined-result" class="hidden"></div>
            </div>

            <!-- RIGHT COLUMN: Chatbot -->
            <div class="bg-white rounded-2xl shadow-xl p-5 border border-gray-100 flex flex-col" style="min-height: 700px;">
                <h2 class="text-lg font-bold mb-4 text-purple-800 flex items-center border-b border-gray-200 pb-3">
                    <div class="w-9 h-9 bg-purple-100 rounded-lg flex items-center justify-center mr-3">
                        <i class="fas fa-robot text-purple-600"></i>
                    </div>
                    <span>Chatbot T∆∞ v·∫•n AI</span>
                    <span class="ml-auto flex items-center text-xs font-normal space-x-2">
                        <span class="bg-green-100 text-green-700 px-2 py-1 rounded-full">
                            <i class="fas fa-circle text-xs mr-1 animate-pulse"></i>24/7
                        </span>
                        <span class="bg-purple-100 text-purple-700 px-2 py-1 rounded-full">
                            <i class="fas fa-microphone mr-1"></i>Voice
                        </span>
                    </span>
                </h2>

                <!-- Chat Messages -->
                <div id="chat-messages" class="flex-1 overflow-y-auto mb-4 p-3 bg-gradient-to-br from-gray-50 to-gray-100/50 rounded-xl scrollbar-thin" style="max-height: 480px;">
                    <div class="flex justify-start mb-4">
                        <div class="bg-white text-gray-800 rounded-2xl px-4 py-3 max-w-md shadow-md border border-gray-100" style="border-bottom-left-radius: 0.5rem;">
                            <div class="flex items-center mb-2">
                                <div class="w-7 h-7 bg-purple-100 rounded-full flex items-center justify-center mr-2">
                                    <i class="fas fa-robot text-purple-600 text-xs"></i>
                                </div>
                                <span class="font-semibold text-purple-800 text-sm">Tr·ª£ l√Ω AI Parkinson</span>
                            </div>
                            <div class="text-sm leading-relaxed">
                                Xin ch√†o! T√¥i l√† tr·ª£ l√Ω AI chuy√™n v·ªÅ b·ªánh Parkinson. T√¥i c√≥ th·ªÉ:
                                <ul class="mt-2 space-y-1 text-gray-600">
                                    <li><i class="fas fa-check text-green-500 mr-1"></i>Gi·∫£i ƒë√°p th·∫Øc m·∫Øc v·ªÅ Parkinson</li>
                                    <li><i class="fas fa-check text-green-500 mr-1"></i>G·ª£i √Ω video b√†i t·∫≠p ph·ª•c h·ªìi</li>
                                    <li><i class="fas fa-check text-green-500 mr-1"></i>T∆∞ v·∫•n ch·∫ø ƒë·ªô sinh ho·∫°t</li>
                                </ul>
                                <p class="mt-2 text-purple-600"><i class="fas fa-microphone mr-1"></i>Nh·∫•n n√∫t Micro ƒë·ªÉ n√≥i!</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Chat Input -->
                <form id="chat-form" class="flex space-x-2 items-center">
                    <button type="button" id="voice-btn" class="voice-btn bg-gradient-to-r from-purple-600 to-purple-700 text-white w-12 h-12 rounded-full flex items-center justify-center shadow-md flex-shrink-0" title="Nh·∫•n ƒë·ªÉ n√≥i">
                        <i class="fas fa-microphone text-lg" id="voice-icon"></i>
                    </button>
                    
                    <input type="text" name="message" id="chat-input" placeholder="Nh·∫≠p c√¢u h·ªèi ho·∫∑c nh·∫•n Micro..." class="flex-1 border-2 border-gray-200 rounded-full px-5 py-3 text-base focus:outline-none focus:border-purple-400 shadow-sm">
                    
                    <button type="submit" class="bg-gradient-to-r from-teal-600 to-teal-700 text-white w-12 h-12 rounded-full flex items-center justify-center shadow-md flex-shrink-0">
                        <i class="fas fa-paper-plane text-lg"></i>
                    </button>
                </form>
                
                <div id="voice-status" class="hidden mt-2 text-center">
                    <div class="inline-flex items-center px-3 py-1 bg-red-100 text-red-700 rounded-full text-sm">
                        <i class="fas fa-circle text-red-500 animate-pulse mr-2"></i>
                        <span id="voice-status-text">ƒêang l·∫Øng nghe...</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Video Section -->
        <div class="mt-8 bg-white rounded-2xl shadow-xl p-6 border border-gray-100">
            <h2 class="text-xl font-bold mb-5 text-red-700 flex items-center">
                <div class="w-10 h-10 bg-red-100 rounded-lg flex items-center justify-center mr-3">
                    <i class="fab fa-youtube text-red-600"></i>
                </div>
                <span>Video B√†i t·∫≠p Ph·ª•c h·ªìi Ch·ª©c nƒÉng</span>
            </h2>
            
            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
                <div class="bg-gray-50 rounded-xl overflow-hidden shadow-md">
                    <div class="youtube-embed">
                        <iframe src="https://www.youtube.com/embed/DS73cE9q79o" title="B√†i t·∫≠p c√¢n b·∫±ng" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                    </div>
                    <div class="p-3">
                        <h3 class="font-semibold text-sm text-gray-800">C·∫£i thi·ªán c√¢n b·∫±ng v√† d√°ng ƒëi</h3>
                        <p class="text-xs text-gray-500 mt-1">B√†i t·∫≠p gi√∫p c·∫£i thi·ªán thƒÉng b·∫±ng</p>
                    </div>
                </div>
                
                <div class="bg-gray-50 rounded-xl overflow-hidden shadow-md">
                    <div class="youtube-embed">
                        <iframe src="https://www.youtube.com/embed/bMcCqi6tllk" title="ƒê·ª©ng l√™n ng·ªìi xu·ªëng" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                    </div>
                    <div class="p-3">
                        <h3 class="font-semibold text-sm text-gray-800">ƒê·ª©ng l√™n ng·ªìi xu·ªëng t·∫°i gi∆∞·ªùng</h3>
                        <p class="text-xs text-gray-500 mt-1">TƒÉng c∆∞·ªùng s·ª©c m·∫°nh ch√¢n</p>
                    </div>
                </div>
                
                <div class="bg-gray-50 rounded-xl overflow-hidden shadow-md">
                    <div class="youtube-embed">
                        <iframe src="https://www.youtube.com/embed/ND5eAvEREmg" title="Xoay tr·ªü t·∫°i gi∆∞·ªùng" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                    </div>
                    <div class="p-3">
                        <h3 class="font-semibold text-sm text-gray-800">Xoay tr·ªü t·∫°i gi∆∞·ªùng</h3>
                        <p class="text-xs text-gray-500 mt-1">C·∫£i thi·ªán v·∫≠n ƒë·ªông khi n·∫±m</p>
                    </div>
                </div>
            </div>
            
            <div class="mt-4 p-3 bg-yellow-50 border-l-4 border-yellow-400 rounded-r-lg">
                <p class="text-yellow-800 text-sm flex items-start">
                    <i class="fas fa-exclamation-triangle mr-2 mt-0.5"></i>
                    <span><strong>L∆∞u √Ω An to√†n:</strong> Th·ª±c hi·ªán b√†i t·∫≠p khi c√≥ ng∆∞·ªùi th√¢n gi√°m s√°t ho·∫∑c b√°m v√†o v·ªã tr√≠ ch·∫Øc ch·∫Øn ƒë·ªÉ tr√°nh t√© ng√£.</span>
                </p>
            </div>
        </div>
    </main>

    <!-- FOOTER -->
    <footer class="bg-gray-800 text-white py-5 mt-8">
        <div class="container mx-auto px-4 text-center">
            <p class="text-gray-400 text-sm mb-2">
                <i class="fas fa-exclamation-triangle text-yellow-500 mr-2"></i>
                M·ªçi th√¥ng tin tr√™n ƒë√¢y ch·ªâ mang t√≠nh tham kh·∫£o. KH√îNG t·ª± √Ω s·ª≠ d·ª•ng thu·ªëc. Vui l√≤ng ƒë·∫øn c∆° s·ªü y t·∫ø ƒë·ªÉ ƒë∆∞·ª£c thƒÉm kh√°m.
            </p>
            <p class="text-gray-500 text-xs">
                ¬© 2025 D·ª± √°n KHKT - Tr∆∞·ªùng THCS Nguy·ªÖn T·∫•t Th√†nh | Powered by ResNet18 + Gemini AI
            </p>
        </div>
    </footer>

    <!-- JavaScript -->
    <script>
        // ========================================
        // GLOBAL VARIABLES
        // ========================================
        let isRecording = false;
        let recognition = null;
        let ttsEnabled = true;
        let currentUtterance = null;
        
        // ========================================
        // IMPROVED TEXT-TO-SPEECH
        // ========================================
        function speakText(text) {
            if (!ttsEnabled) return;
            
            // Cancel any ongoing speech
            window.speechSynthesis.cancel();
            
            // Clean HTML tags
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = text;
            let plainText = tempDiv.textContent || tempDiv.innerText || '';
            
            // Clean up special characters
            plainText = plainText.replace(/[‚Ä¢\-\*]/g, ',').replace(/\s+/g, ' ').trim();
            
            if (!plainText || plainText.length < 3) return;
            
            // Show indicator
            document.getElementById('tts-indicator').classList.remove('hidden');
            
            // Split into chunks for better TTS
            const maxLength = 300;
            const chunks = [];
            let remaining = plainText;
            
            while (remaining.length > 0) {
                if (remaining.length <= maxLength) {
                    chunks.push(remaining);
                    break;
                }
                let splitIndex = remaining.lastIndexOf('.', maxLength);
                if (splitIndex === -1) splitIndex = remaining.lastIndexOf(',', maxLength);
                if (splitIndex === -1) splitIndex = maxLength;
                chunks.push(remaining.substring(0, splitIndex + 1));
                remaining = remaining.substring(splitIndex + 1).trim();
            }
            
            let chunkIndex = 0;
            
            function speakNextChunk() {
                if (chunkIndex >= chunks.length || !ttsEnabled) {
                    document.getElementById('tts-indicator').classList.add('hidden');
                    return;
                }
                
                const utterance = new SpeechSynthesisUtterance(chunks[chunkIndex]);
                utterance.lang = 'vi-VN';
                utterance.rate = 0.85;
                utterance.pitch = 1;
                utterance.volume = 1;
                
                // Get Vietnamese voice
                const voices = window.speechSynthesis.getVoices();
                const viVoice = voices.find(v => v.lang.includes('vi')) || voices.find(v => v.lang.includes('en'));
                if (viVoice) utterance.voice = viVoice;
                
                utterance.onend = function() {
                    chunkIndex++;
                    speakNextChunk();
                };
                
                utterance.onerror = function() {
                    document.getElementById('tts-indicator').classList.add('hidden');
                };
                
                currentUtterance = utterance;
                window.speechSynthesis.speak(utterance);
            }
            
            // Start speaking
            setTimeout(speakNextChunk, 100);
        }
        
        // ========================================
        // VOICE RECOGNITION
        // ========================================
        function initVoiceRecognition() {
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                recognition = new SpeechRecognition();
                recognition.lang = 'vi-VN';
                recognition.continuous = false;
                recognition.interimResults = true;
                
                recognition.onstart = function() {
                    isRecording = true;
                    document.getElementById('voice-btn').classList.add('recording', 'recording-animation');
                    document.getElementById('voice-icon').className = 'fas fa-stop text-lg';
                    document.getElementById('voice-status').classList.remove('hidden');
                    document.getElementById('voice-status-text').textContent = 'ƒêang l·∫Øng nghe...';
                };
                
                recognition.onresult = function(event) {
                    let transcript = '';
                    for (let i = event.resultIndex; i < event.results.length; i++) {
                        transcript += event.results[i][0].transcript;
                    }
                    document.getElementById('chat-input').value = transcript;
                    document.getElementById('voice-status-text').textContent = 'ƒêang nh·∫≠n: ' + transcript.substring(0, 30) + '...';
                };
                
                recognition.onend = function() {
                    isRecording = false;
                    document.getElementById('voice-btn').classList.remove('recording', 'recording-animation');
                    document.getElementById('voice-icon').className = 'fas fa-microphone text-lg';
                    document.getElementById('voice-status').classList.add('hidden');
                    
                    const input = document.getElementById('chat-input').value.trim();
                    if (input) {
                        setTimeout(() => {
                            document.getElementById('chat-form').dispatchEvent(new Event('submit'));
                        }, 300);
                    }
                };
                
                recognition.onerror = function(event) {
                    console.error('Speech recognition error:', event.error);
                    isRecording = false;
                    document.getElementById('voice-btn').classList.remove('recording', 'recording-animation');
                    document.getElementById('voice-icon').className = 'fas fa-microphone text-lg';
                    document.getElementById('voice-status').classList.add('hidden');
                    
                    if (event.error === 'not-allowed') {
                        alert('Vui l√≤ng cho ph√©p tr√¨nh duy·ªát truy c·∫≠p microphone.');
                    }
                };
                
                return true;
            }
            return false;
        }
        
        // ========================================
        // EVENT HANDLERS
        // ========================================
        
        // Voice button
        document.getElementById('voice-btn').addEventListener('click', function() {
            if (!recognition && !initVoiceRecognition()) {
                alert('Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£ nh·∫≠n d·∫°ng gi·ªçng n√≥i. Vui l√≤ng d√πng Chrome ho·∫∑c Edge.');
                return;
            }
            if (isRecording) recognition.stop();
            else recognition.start();
        });
        
        // Global TTS Toggle
        document.getElementById('global-tts-toggle').addEventListener('click', function() {
            ttsEnabled = !ttsEnabled;
            const icon = document.getElementById('global-tts-icon');
            const text = document.getElementById('global-tts-text');
            if (ttsEnabled) {
                icon.className = 'fas fa-volume-up mr-2';
                text.textContent = 'Loa: B·∫¨T';
                this.classList.remove('bg-red-500/30');
                this.classList.add('bg-white/20');
            } else {
                icon.className = 'fas fa-volume-mute mr-2';
                text.textContent = 'Loa: T·∫ÆT';
                this.classList.remove('bg-white/20');
                this.classList.add('bg-red-500/30');
                window.speechSynthesis.cancel();
                document.getElementById('tts-indicator').classList.add('hidden');
            }
        });
        
        // File input
        const fileInput = document.getElementById('file-input');
        const dropZone = document.getElementById('drop-zone');
        
        fileInput.addEventListener('change', function(e) {
            if (e.target.files[0]) showPreview(e.target.files[0]);
        });
        
        dropZone.addEventListener('dragover', e => { e.preventDefault(); dropZone.classList.add('border-blue-500', 'bg-blue-50'); });
        dropZone.addEventListener('dragleave', e => { e.preventDefault(); dropZone.classList.remove('border-blue-500', 'bg-blue-50'); });
        dropZone.addEventListener('drop', function(e) {
            e.preventDefault();
            dropZone.classList.remove('border-blue-500', 'bg-blue-50');
            if (e.dataTransfer.files[0]?.type.startsWith('image/')) {
                fileInput.files = e.dataTransfer.files;
                showPreview(e.dataTransfer.files[0]);
            }
        });
        
        function showPreview(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('preview-img').src = e.target.result;
                document.getElementById('image-preview').classList.remove('hidden');
                document.getElementById('file-label').innerHTML = `
                    <div class="text-green-600"><i class="fas fa-check-circle text-3xl"></i></div>
                    <p class="text-sm font-medium text-gray-700 mt-1">${file.name}</p>
                `;
            };
            reader.readAsDataURL(file);
        }
        
        // ========================================
        // COMBINED ANALYSIS (Image + Symptoms)
        // ========================================
        document.getElementById('combined-analysis-btn').addEventListener('click', async function() {
            const symptoms = Array.from(document.querySelectorAll('#symptomForm input:checked')).map(cb => cb.value);
            const imageFile = document.getElementById('file-input').files[0];
            
            if (!imageFile && symptoms.length === 0) {
                alert('Vui l√≤ng t·∫£i ·∫£nh xo·∫Øn ·ªëc ho·∫∑c ch·ªçn √≠t nh·∫•t m·ªôt tri·ªáu ch·ª©ng ƒë·ªÉ ph√¢n t√≠ch.');
                return;
            }
            
            const resultDiv = document.getElementById('combined-result');
            resultDiv.classList.remove('hidden');
            resultDiv.innerHTML = `
                <div class="bg-white rounded-2xl shadow-xl p-6 border border-gray-100">
                    <div class="flex items-center justify-center p-8">
                        <div class="text-center">
                            <i class="fas fa-spinner fa-spin text-indigo-600 text-4xl mb-3"></i>
                            <p class="text-indigo-700 font-semibold">ƒêang ph√¢n t√≠ch t·ªïng h·ª£p...</p>
                            <p class="text-gray-500 text-sm mt-1">K·∫øt h·ª£p nh·∫≠n di·ªán ·∫£nh + tri·ªáu ch·ª©ng</p>
                        </div>
                    </div>
                </div>
            `;
            
            const formData = new FormData();
            if (imageFile) formData.append('image', imageFile);
            formData.append('symptoms', JSON.stringify(symptoms));
            
            try {
                const response = await fetch('/combined_analysis', {
                    method: 'POST',
                    body: formData
                });
                const data = await response.json();
                
                if (data.error) {
                    resultDiv.innerHTML = `<div class="bg-red-50 border-l-4 border-red-500 p-5 rounded-xl text-red-700">${data.error}</div>`;
                } else {
                    resultDiv.innerHTML = `
                        <div class="bg-white rounded-2xl shadow-xl p-6 border border-gray-100 space-y-4">
                            <h3 class="text-xl font-bold text-indigo-800 flex items-center border-b pb-3">
                                <i class="fas fa-clipboard-check mr-3 text-2xl"></i>
                                K·∫øt qu·∫£ Ph√¢n t√≠ch T·ªïng h·ª£p
                            </h3>
                            
                            ${data.image_result ? `
                            <div class="grid md:grid-cols-2 gap-4">
                                <div class="bg-gray-50 p-4 rounded-xl">
                                    <p class="text-xs text-gray-500 mb-2 font-medium">·∫¢nh ƒë√£ ph√¢n t√≠ch</p>
                                    <img src="data:image/jpeg;base64,${data.image_base64}" class="w-full h-40 object-contain rounded-lg">
                                </div>
                                <div class="bg-gradient-to-r ${data.image_result.includes('Healthy') ? 'from-green-50 to-emerald-50 border-green-300' : 'from-red-50 to-orange-50 border-red-300'} p-4 rounded-xl border-2">
                                    <h4 class="font-bold ${data.image_result.includes('Healthy') ? 'text-green-800' : 'text-red-800'} mb-2">
                                        <i class="fas ${data.image_result.includes('Healthy') ? 'fa-check-circle' : 'fa-exclamation-triangle'} mr-2"></i>
                                        K·∫øt qu·∫£ Nh·∫≠n di·ªán ·∫¢nh
                                    </h4>
                                    <p class="text-sm ${data.image_result.includes('Healthy') ? 'text-green-700' : 'text-red-700'}">${data.image_result}</p>
                                    <p class="text-sm font-medium mt-2">ƒê·ªô tin c·∫≠y: ${(data.confidence * 100).toFixed(1)}%</p>
                                </div>
                            </div>
                            ` : ''}
                            
                            <div class="prose-custom bg-gradient-to-br from-indigo-50 to-purple-50 p-5 rounded-xl border border-indigo-200">
                                <h4 class="font-bold text-indigo-800 mb-3 flex items-center">
                                    <i class="fas fa-brain mr-2"></i>Ph√¢n t√≠ch AI T·ªïng h·ª£p
                                </h4>
                                <div class="text-gray-800 leading-relaxed">${data.analysis}</div>
                            </div>
                        </div>
                    `;
                    
                    // Speak the result
                    speakText(data.analysis);
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="bg-red-50 border-l-4 border-red-500 p-5 rounded-xl text-red-700">L·ªói k·∫øt n·ªëi. Vui l√≤ng th·ª≠ l·∫°i.</div>`;
            }
        });
        
        // ========================================
        // CHAT FORM
        // ========================================
        document.getElementById('chat-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            const input = document.getElementById('chat-input');
            const message = input.value.trim();
            if (!message) return;
            
            const messagesDiv = document.getElementById('chat-messages');
            
            // Add user message
            messagesDiv.innerHTML += `
                <div class="flex justify-end mb-3">
                    <div class="bg-gradient-to-r from-teal-600 to-teal-700 text-white rounded-2xl px-4 py-2 max-w-xs shadow-md text-sm" style="border-bottom-right-radius: 0.5rem;">
                        ${message}
                    </div>
                </div>
            `;
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
            input.value = '';
            
            // Loading
            messagesDiv.innerHTML += `
                <div class="flex justify-start mb-3" id="loading-bubble">
                    <div class="bg-white rounded-2xl px-4 py-3 shadow-md border border-gray-100">
                        <div class="flex items-center space-x-2">
                            <i class="fas fa-circle text-xs text-purple-400 animate-bounce"></i>
                            <i class="fas fa-circle text-xs text-purple-400 animate-bounce" style="animation-delay: 0.1s;"></i>
                            <i class="fas fa-circle text-xs text-purple-400 animate-bounce" style="animation-delay: 0.2s;"></i>
                        </div>
                    </div>
                </div>
            `;
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
            
            try {
                const response = await fetch('/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: message })
                });
                const data = await response.json();
                
                document.getElementById('loading-bubble')?.remove();
                
                // Process response to embed YouTube videos
                let processedResponse = processYouTubeVideos(data.response);
                
                messagesDiv.innerHTML += `
                    <div class="flex justify-start mb-3">
                        <div class="bg-white text-gray-800 rounded-2xl px-4 py-3 max-w-md shadow-md border border-gray-100 text-sm" style="border-bottom-left-radius: 0.5rem;">
                            <div class="flex items-center mb-2">
                                <div class="w-6 h-6 bg-purple-100 rounded-full flex items-center justify-center mr-2">
                                    <i class="fas fa-robot text-purple-600 text-xs"></i>
                                </div>
                                <span class="font-semibold text-purple-800 text-xs">Tr·ª£ l√Ω AI</span>
                            </div>
                            <div class="prose-custom leading-relaxed">${processedResponse}</div>
                        </div>
                    </div>
                `;
                messagesDiv.scrollTop = messagesDiv.scrollHeight;
                
                // Speak response
                speakText(data.response);
                
            } catch (error) {
                document.getElementById('loading-bubble')?.remove();
                messagesDiv.innerHTML += `
                    <div class="flex justify-start mb-3">
                        <div class="bg-red-50 text-red-700 rounded-2xl px-4 py-2 text-sm border-l-4 border-red-500">
                            L·ªói k·∫øt n·ªëi. Vui l√≤ng th·ª≠ l·∫°i.
                        </div>
                    </div>
                `;
            }
        });
        
        // ========================================
        // YOUTUBE VIDEO EMBED IN CHAT
        // ========================================
        function processYouTubeVideos(text) {
            // Pattern: [VIDEO:VIDEO_ID:Title]
            const videoPattern = /\[VIDEO:([a-zA-Z0-9_-]+):([^\]]+)\]/g;
            
            return text.replace(videoPattern, function(match, videoId, title) {
                return `
                    <div class="my-3 rounded-xl overflow-hidden shadow-md bg-gray-900">
                        <div class="relative" style="padding-bottom: 56.25%; height: 0;">
                            <iframe 
                                src="https://www.youtube.com/embed/${videoId}" 
                                title="${title}"
                                class="absolute top-0 left-0 w-full h-full"
                                frameborder="0" 
                                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                                allowfullscreen>
                            </iframe>
                        </div>
                        <div class="bg-red-600 text-white px-3 py-2 text-xs font-medium flex items-center">
                            <i class="fab fa-youtube mr-2"></i>${title}
                        </div>
                    </div>
                `;
            });
        }
        
        // ========================================
        // INIT
        // ========================================
        document.addEventListener('DOMContentLoaded', function() {
            initVoiceRecognition();
            if ('speechSynthesis' in window) {
                speechSynthesis.onvoiceschanged = () => speechSynthesis.getVoices();
                // Preload voices
                speechSynthesis.getVoices();
            }
        });
    </script>
</body>
</html>
